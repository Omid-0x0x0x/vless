name: Auto Update VLESS Configs (Rust)

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v3
      
      # Ù†ØµØ¨ Rust
      - name: ğŸ¦€ Setup Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true
      
      # Build Ú©Ø±Ø¯Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡
      - name: ğŸ”¨ Build Rust binary
        run: |
          cd rust-processor  # ÛŒØ§ Ù‡Ø± Ù¾ÙˆØ´Ù‡â€ŒØ§ÛŒ Ú©Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Rust Ø¯Ø± Ø¢Ù† Ù‡Ø³ØªÙ†Ø¯
          cargo build --release
          ls -lh target/release/
      
      # Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒÙ‡Ø§
      - name: ğŸ§¹ Clean old configs
        run: |
          rm -rf configs/
          mkdir -p configs/
      
      # Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
      - name: ğŸš€ Process configs
        run: |
          cd rust-processor
          ./target/release/vless-processor ../subscriptions.txt
      
      # Commit Ùˆ Push
      - name: ğŸ’¾ Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add configs/ README.md
          git diff --staged --quiet || (git commit -m "ğŸ”„ Auto-update - $(date '+%Y-%m-%d %H:%M:%S')" && git push)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
